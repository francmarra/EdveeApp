@model Edveeeeeee.Models.ViewModels.EdVeeViewModel

<!-- CSS para estilos melhorados de adição de tópicos -->
<link rel="stylesheet" href="~/css/add-topic-styles.css" />

<h2>EdVee: @Model.UnidadeCurricular.Nome</h2>

@if (!string.IsNullOrWhiteSpace(Model.UnidadeCurricular.Descricao))
{
    <p><em>@Model.UnidadeCurricular.Descricao</em></p>
}

<!-- Connections Section Start -->
<div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin-top: 20px;">
    <h4>Conexões Entre Secções</h4>
    <div class="connection-controls">
        <button id="toggleConnectionMode" class="btn-connection-mode inactive">Modo de Conexão: DESLIGADO</button>
        <button id="clearConnections" class="btn-clear-connections" style="display: none;">Limpar Conexões</button>
        <button id="saveConnections" class="btn-save-connections" style="display: none;">Salvar Conexões</button>
    </div>
    <div class="connection-instructions" style="display:none; margin-top: 10px;">
        <p>Para criar uma ligação: <b>Clique</b> em um elemento e depois <b>clique</b> em outro elemento para ligar.</p>
    </div>
</div>

<!-- LeaderLine CDN -->
<script src="https://cdn.jsdelivr.net/npm/leader-line@1.0.7/leader-line.min.js"></script>
<script>
    // Variáveis para controle de ligações
    let connectionMode = false;
    let selectedElement = null;
    let lines = [];
    let currentConnections = [];
      // Função para posicionar corretamente os pontos de conexão
    function positionConnectionPoints() {
        document.querySelectorAll('.connectable').forEach(element => {
            // Pega o ID do elemento conectável
            const id = element.dataset.id;
            const section = element.dataset.section;
            
            // Encontra os pontos de conexão relacionados
            const connectionPoints = document.querySelectorAll(`.connection-point[data-for="${id}"]`);
            
            connectionPoints.forEach(point => {
                // Ajusta a posição vertical para alinhar com o elemento
                const elementRect = element.getBoundingClientRect();
                const containerRect = point.parentElement.getBoundingClientRect();
                
                // Calcula a posição vertical relativa ao contêiner
                // Usamos altura exata dividida por 2 para garantir o centro exato
                const top = elementRect.top - containerRect.top + (elementRect.height / 2) - (point.offsetHeight / 2);
                
                // Define a posição do ponto
                point.style.top = `${top}px`;
            });
        });
    }
    
    // Função para recuperar as ligações existentes do servidor
    async function loadConnections() {
        try {
            const response = await fetch('/UC/GetConnections/@Model.UnidadeCurricular.Id');
            if (response.ok) {
                const connections = await response.json();
                currentConnections = connections; // Armazena as conexões recuperadas
                renderConnections(connections);
            }
        } catch (error) {
            console.error('Erro ao carregar conexões:', error);
        }
    }
    
    // Função para salvar as conexões criadas
    async function saveConnections() {
        try {
            const response = await fetch('/UC/SaveConnections', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    ucId: @Model.UnidadeCurricular.Id,
                    connections: currentConnections
                })
            });
            
            if (response.ok) {
                alert('Conexões salvas com sucesso!');
            } else {
                alert('Erro ao salvar conexões.');
            }
        } catch (error) {
            console.error('Erro ao salvar conexões:', error);
            alert('Erro ao salvar as conexões.');
        }
    }
    
    // Função para desenhar as ligações na tela
    function renderConnections(connections) {
        // Limpa as linhas existentes
        clearLines();
        
        // Para cada conexão, cria uma linha
        connections.forEach(conn => {
            const origemElement = document.querySelector(`[data-id="${conn.origemTipo}-${conn.origemId}"]`);
            const destinoElement = document.querySelector(`[data-id="${conn.destinoTipo}-${conn.destinoId}"]`);
            
            if (origemElement && destinoElement) {
                // Encontra os pontos de conexão externos
                const origemPoint = document.querySelector(`.connection-point[data-for="${conn.origemTipo}-${conn.origemId}"]`);
                const destinoPoint = document.querySelector(`.connection-point[data-for="${conn.destinoTipo}-${conn.destinoId}"]`);
                
                if (origemPoint && destinoPoint) {
                    // Define a cor da linha baseada nos tipos de origem e destino
                    let lineColor = getLineColor(origemElement.dataset.section, destinoElement.dataset.section);
                      // Cria uma linha simples usando os pontos de conexão externos
                    const line = new LeaderLine(
                        origemPoint,
                        destinoPoint,
                        {
                            path: 'straight',
                            endPlug: 'behind',
                            startPlug: 'behind',
                            size: 2,
                            color: lineColor,
                            startSocket: 'right',
                            endSocket: 'left',
                            startSocketGravity: 0,  // Sem curva na saída
                            endSocketGravity: 0,    // Sem curva na chegada
                            startPlugSize: 1, // Tamanho reduzido para melhor alinhamento
                            endPlugSize: 1,    // Tamanho reduzido para melhor alinhamento
                            dash: {animation: true}
                        }
                    );
                    lines.push(line);
                }
            }
        });
    }
    
    // Função para determinar a cor da linha baseada nos tipos de origem e destino
    function getLineColor(origemSection, destinoSection) {
        // Cor padrão
        let color = '#0066cc';
        
        // Cores por tipo de seção
        if ((origemSection === 'Conteudo' && destinoSection === 'Atividade') || 
            (origemSection === 'Atividade' && destinoSection === 'Conteudo')) {
            color = '#4caf50'; // Verde para conexões Conteudo-Atividade
        } else if ((origemSection === 'Competencia' && destinoSection === 'Avaliacao') || 
                  (origemSection === 'Avaliacao' && destinoSection === 'Competencia')) {
            color = '#2196f3'; // Azul para conexões Competencia-Avaliacao
        } else if ((origemSection === 'Competencia' && destinoSection === 'Atividade') || 
                  (origemSection === 'Atividade' && destinoSection === 'Competencia')) {
            color = '#e91e63'; // Rosa para conexões Competencia-Atividade
        } else if ((origemSection === 'Conteudo' && destinoSection === 'Avaliacao') || 
                  (origemSection === 'Avaliacao' && destinoSection === 'Conteudo')) {
            color = '#ffc107'; // Amarelo para conexões Conteudo-Avaliacao
        }
        
        return color;
    }
    
    // Função para limpar todas as linhas
    function clearLines() {
        lines.forEach(line => line.remove());
        lines = [];
        // Mantém as conexões para que possamos restaurá-las ao sair do modo de conexão
        if (connectionMode) {
            currentConnections = [];
        }
    }
    
    // Função para ativar/desativar o modo de conexão
    function toggleConnectionMode() {
        connectionMode = !connectionMode;
        const button = document.getElementById('toggleConnectionMode');
        const instructions = document.querySelector('.connection-instructions');
        const clearBtn = document.getElementById('clearConnections');
        const saveBtn = document.getElementById('saveConnections');
        
        if (connectionMode) {
            button.textContent = 'Modo de Conexão: LIGADO';
            button.classList.add('active');
            button.classList.remove('inactive');
            instructions.style.display = 'block';
            clearBtn.style.display = 'inline-block';
            saveBtn.style.display = 'inline-block';
            
            // Adiciona classe de destaque aos pontos de conexão
            document.querySelectorAll('.connection-point').forEach(el => {
                el.classList.add('connection-mode');
            });
        } else {
            button.textContent = 'Modo de Conexão: DESLIGADO';
            button.classList.remove('active');
            button.classList.add('inactive');
            instructions.style.display = 'none';
            clearBtn.style.display = 'none';
            saveBtn.style.display = 'none';
            selectedElement = null;
            
            // Remove classe de destaque
            document.querySelectorAll('.connection-point').forEach(el => {
                el.classList.remove('connection-mode');
                el.classList.remove('selected-element');
            });
            
            // Renderiza novamente as conexões existentes
            renderStoredConnections();
        }
    }
    
    // Função para renderizar as conexões armazenadas sem limpar a lista atual
    function renderStoredConnections() {
        // Limpa apenas as linhas visuais, mantendo as conexões armazenadas
        lines.forEach(line => line.remove());
        lines = [];
        
        // Para cada conexão armazenada, cria uma linha visual
        currentConnections.forEach(conn => {
            const origemElement = document.querySelector(`[data-id="${conn.origemTipo}-${conn.origemId}"]`);
            const destinoElement = document.querySelector(`[data-id="${conn.destinoTipo}-${conn.destinoId}"]`);
            
            if (origemElement && destinoElement) {
                // Encontra os pontos de conexão externos
                const origemPoint = document.querySelector(`.connection-point[data-for="${conn.origemTipo}-${conn.origemId}"]`);
                const destinoPoint = document.querySelector(`.connection-point[data-for="${conn.destinoTipo}-${conn.destinoId}"]`);
                
                if (origemPoint && destinoPoint) {
                    let lineColor = getLineColor(origemElement.dataset.section, destinoElement.dataset.section);
                      // Cria a linha visual
                    const line = new LeaderLine(
                        origemPoint,
                        destinoPoint,
                        {
                            path: 'straight',
                            endPlug: 'behind',
                            startPlug: 'behind',
                            size: 2,
                            color: lineColor,
                            startSocket: 'right',
                            endSocket: 'left',
                            startSocketGravity: 0,
                            endSocketGravity: 0,
                            startPlugSize: 1, // Tamanho reduzido para melhor alinhamento
                            endPlugSize: 1,    // Tamanho reduzido para melhor alinhamento
                            dash: {animation: true}
                        }
                    );
                    lines.push(line);
                }
            }
        });
    }
    
    // Manipulador de clique para selecionar elementos
    function handleConnectionPointClick(e) {
        if (!connectionMode) return;
        
        const element = e.currentTarget;
        const connectableId = element.dataset.for;
        
        if (!selectedElement) {
            // Primeira seleção
            selectedElement = element;
            element.classList.add('selected-element');
        } else if (selectedElement === element) {
            // Clicou no mesmo elemento - deseleciona
            selectedElement.classList.remove('selected-element');
            selectedElement = null;
        } else {
            // Segunda seleção - cria a conexão
            const origem = selectedElement;
            const destino = element;
            
            // Busca os IDs dos elementos conectáveis
            const origemConnectableId = origem.dataset.for;
            const destinoConnectableId = destino.dataset.for;
            
            // Extrai tipo e ID
            const [origemTipo, origemId] = origemConnectableId.split('-');
            const [destinoTipo, destinoId] = destinoConnectableId.split('-');
            
            // Encontra os elementos conectáveis para usar seus datasets
            const origemElement = document.querySelector(`[data-id="${origemConnectableId}"]`);
            const destinoElement = document.querySelector(`[data-id="${destinoConnectableId}"]`);
            
            // Verifica se a conexão já existe
            const existingConnection = currentConnections.find(
                conn => conn.origemId == origemId && 
                       conn.origemTipo === origemTipo &&
                       conn.destinoId == destinoId &&
                       conn.destinoTipo === destinoTipo
            );
            
            if (!existingConnection && origemElement && destinoElement) {
                // Define a cor da linha baseada nas seções
                let lineColor = getLineColor(origemElement.dataset.section, destinoElement.dataset.section);                    // Cria a linha visual simples
                const line = new LeaderLine(
                    origem,
                    destino,
                    {
                        path: 'straight',
                        endPlug: 'behind',
                        startPlug: 'behind',
                        size: 2,
                        color: lineColor,
                        startSocket: 'right',
                        endSocket: 'left',
                        startSocketGravity: 0,
                        endSocketGravity: 0,
                        startPlugSize: 1, // Tamanho reduzido para melhor alinhamento
                        endPlugSize: 1    // Tamanho reduzido para melhor alinhamento
                    }
                );
                lines.push(line);
                
                // Adiciona à lista de conexões
                currentConnections.push({
                    origemTipo: origemTipo,
                    origemId: origemId,
                    destinoTipo: destinoTipo,
                    destinoId: destinoId
                });
            }
            
            // Limpa a seleção
            selectedElement.classList.remove('selected-element');
            selectedElement = null;
        }
    }
    
    // Inicialização
    window.addEventListener('DOMContentLoaded', () => {
        // Posiciona os pontos de conexão
        positionConnectionPoints();
        
        // Carrega conexões existentes
        loadConnections();
        
        // Configura handlers dos botões
        document.getElementById('toggleConnectionMode').addEventListener('click', toggleConnectionMode);
        document.getElementById('clearConnections').addEventListener('click', () => {
            clearLines();
            if (!connectionMode) {
                renderStoredConnections();
            }
        });
        document.getElementById('saveConnections').addEventListener('click', saveConnections);
        
        // Adiciona handler de clique aos pontos de conexão
        document.querySelectorAll('.connection-point').forEach(el => {
            el.addEventListener('click', handleConnectionPointClick);
        });
        
        // Ajusta as linhas quando a janela é redimensionada
        window.addEventListener('resize', () => {
            positionConnectionPoints();
            lines.forEach(line => line.position());
        });
        
        // Observer para mudanças no layout
        const observer = new MutationObserver(() => {
            positionConnectionPoints();
            lines.forEach(line => line.position());
        });
        
        // Observa mudanças no layout
        observer.observe(document.body, { 
            childList: true, 
            subtree: true,
            attributes: true
        });        // Add topic form toggle functionality
        document.querySelectorAll('.add-topic-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const targetForm = document.getElementById(targetId);
                
                // Efeito visual ao clicar no botão
                this.style.transform = 'scale(0.98)';
                setTimeout(() => {
                    this.style.transform = 'scale(1)';
                }, 150);
                
                // Close any open forms first
                document.querySelectorAll('.add-topic-form.active').forEach(openForm => {
                    if (openForm.id !== targetId) {
                        openForm.classList.remove('active');
                        setTimeout(() => {
                            openForm.querySelector('textarea').value = ''; // Clear the input
                        }, 300);
                    }
                });
                
                // Toggle the target form
                targetForm.classList.toggle('active');
                
                // Focus on the textarea if form is now active
                if (targetForm.classList.contains('active')) {
                    setTimeout(() => {
                        targetForm.querySelector('textarea').focus();
                    }, 100);
                }
            });
        });
        
        // Cancel button functionality
        document.querySelectorAll('.btn-cancel').forEach(btn => {
            btn.addEventListener('click', function() {
                const form = this.closest('.add-topic-form');
                
                // Efeito visual ao clicar no botão
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = 'scale(1)';
                }, 150);
                
                form.classList.remove('active');
                
                // Clear the input with delay
                setTimeout(() => {
                    form.querySelector('textarea').value = '';
                }, 300);
            });
        });
        
        // Confirm button visual feedback
        document.querySelectorAll('.btn-confirm').forEach(btn => {
            btn.addEventListener('mousedown', function() {
                this.style.transform = 'scale(0.95)';
            });
            
            btn.addEventListener('mouseup', function() {
                this.style.transform = 'scale(1)';
            });
            
            btn.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1)';
            });
        });
    });
</script>

<div class="edvee-matrix">
    <div class="edvee-row">
        <!-- Competências -->
        <div class="edvee-box competencias">
            <h3>Competências</h3>
            <div class="edvee-table">
                @foreach (var c in Model.Competencias)
                {
                    <div class="edvee-row">
                        <div class="edvee-cell">
                            <div class="connectable" data-id="Competencia-@c.Id" data-section="Competencia">
                                @c.Texto
                            </div>
                            <!-- Pontos de conexão à direita -->
                            <div class="connection-point-container connection-points-right">
                                <div class="connection-point" data-section="Competencia" data-for="Competencia-@c.Id"></div>
                            </div>
                        </div>
                        <div class="edvee-cell actions">
                            <div class="dropdown">
                                <button class="dropbtn">⋮</button>
                                <div class="dropdown-content">
                                    <a href="/UC/EditCompetencia/@c.Id">Editar</a>
                                    <form asp-action="DeleteCompetencia" method="post">
                                        <input type="hidden" name="id" value="@c.Id" />
                                        <button type="submit" class="dropdown-btn">Eliminar</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
            <div class="add-topic-container">
                <button class="add-topic-btn" data-target="add-competencia-form">+ Nova Competência</button>
                <div id="add-competencia-form" class="add-topic-form">
                    <form asp-action="AddCompetencia" method="post">
                        <input type="hidden" name="ucId" value="@Model.UnidadeCurricular.Id" />
                        <textarea name="texto" placeholder="Descreva a nova competência..." rows="3"></textarea>
                        <div class="add-topic-actions">
                            <button type="button" class="btn-cancel">Cancelar</button>
                            <button type="submit" class="btn-confirm">Adicionar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Avaliação -->
        <div class="edvee-box avaliacoes">
            <h3>Avaliação</h3>
            <div class="edvee-table">
                @foreach (var a in Model.Avaliacoes)
                {
                    <div class="edvee-row">
                        <div class="edvee-cell">
                            <!-- Pontos de conexão à esquerda -->
                            <div class="connection-point-container connection-points-left">
                                <div class="connection-point" data-section="Avaliacao" data-for="Avaliacao-@a.Id"></div>
                            </div>
                            <div class="connectable" data-id="Avaliacao-@a.Id" data-section="Avaliacao">
                                @a.Texto
                            </div>
                        </div>
                        <div class="edvee-cell actions">
                            <div class="dropdown">
                                <button class="dropbtn">⋮</button>
                                <div class="dropdown-content">
                                    <a href="/UC/EditAvaliacao/@a.Id">Editar</a>
                                    <form asp-action="DeleteAvaliacao" method="post">
                                        <input type="hidden" name="id" value="@a.Id" />
                                        <button type="submit" class="dropdown-btn">Eliminar</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
            <div class="add-topic-container">
                <button class="add-topic-btn" data-target="add-avaliacao-form">+ Nova Avaliação</button>
                <div id="add-avaliacao-form" class="add-topic-form">
                    <form asp-action="AddAvaliacao" method="post">
                        <input type="hidden" name="ucId" value="@Model.UnidadeCurricular.Id" />
                        <textarea name="texto" placeholder="Descreva a nova avaliação..." rows="3"></textarea>
                        <div class="add-topic-actions">
                            <button type="button" class="btn-cancel">Cancelar</button>
                            <button type="submit" class="btn-confirm">Adicionar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <div class="edvee-row">
        <!-- Conteúdos -->
        <div class="edvee-box conteudos">
            <h3>Conteúdos</h3>
            <div class="edvee-table">
                @foreach (var c in Model.Conteudos)
                {
                    <div class="edvee-row">
                        <div class="edvee-cell">
                            <div class="connectable" data-id="Conteudo-@c.Id" data-section="Conteudo">
                                @c.Texto
                            </div>
                            <!-- Pontos de conexão à direita -->
                            <div class="connection-point-container connection-points-right">
                                <div class="connection-point" data-section="Conteudo" data-for="Conteudo-@c.Id"></div>
                            </div>
                        </div>
                        <div class="edvee-cell actions">
                            <div class="dropdown">
                                <button class="dropbtn">⋮</button>
                                <div class="dropdown-content">
                                    <a href="/UC/EditConteudo/@c.Id">Editar</a>
                                    <form asp-action="DeleteConteudo" method="post">
                                        <input type="hidden" name="id" value="@c.Id" />
                                        <button type="submit" class="dropdown-btn">Eliminar</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
            <div class="add-topic-container">
                <button class="add-topic-btn" data-target="add-conteudo-form">+ Novo Conteúdo</button>
                <div id="add-conteudo-form" class="add-topic-form">
                    <form asp-action="AddConteudo" method="post">
                        <input type="hidden" name="ucId" value="@Model.UnidadeCurricular.Id" />
                        <textarea name="texto" placeholder="Descreva o novo conteúdo..." rows="3"></textarea>
                        <div class="add-topic-actions">
                            <button type="button" class="btn-cancel">Cancelar</button>
                            <button type="submit" class="btn-confirm">Adicionar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Atividades -->
        <div class="edvee-box atividades">
            <h3>Atividades</h3>
            <div class="edvee-table">
                @foreach (var a in Model.Atividades)
                {
                    <div class="edvee-row">
                        <div class="edvee-cell">
                            <!-- Pontos de conexão à esquerda -->
                            <div class="connection-point-container connection-points-left">
                                <div class="connection-point" data-section="Atividade" data-for="Atividade-@a.Id"></div>
                            </div>
                            <div class="connectable" data-id="Atividade-@a.Id" data-section="Atividade">
                                @a.Texto
                            </div>
                        </div>
                        <div class="edvee-cell actions">
                            <div class="dropdown">
                                <button class="dropbtn">⋮</button>
                                <div class="dropdown-content">
                                    <a href="/UC/EditAtividade/@a.Id">Editar</a>
                                    <form asp-action="DeleteAtividade" method="post">
                                        <input type="hidden" name="id" value="@a.Id" />
                                        <button type="submit" class="dropdown-btn">Eliminar</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
            <div class="add-topic-container">
                <button class="add-topic-btn" data-target="add-atividade-form">+ Nova Atividade</button>
                <div id="add-atividade-form" class="add-topic-form">
                    <form asp-action="AddAtividade" method="post">
                        <input type="hidden" name="ucId" value="@Model.UnidadeCurricular.Id" />
                        <textarea name="texto" placeholder="Descreva a nova atividade..." rows="3"></textarea>
                        <div class="add-topic-actions">
                            <button type="button" class="btn-cancel">Cancelar</button>
                            <button type="submit" class="btn-confirm">Adicionar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: #f7f7f7;
    }
    
    .btn-edvee {
        background-color: #a60000;
        color: white;
        padding: 8px 14px;
        border-radius: 4px;
        text-decoration: none;
        margin-right: 10px;
    }
    
    .btn-matrix {
        background-color: #0055aa;
        color: white;
        padding: 8px 14px;
        border-radius: 4px;
        text-decoration: none;
    }
    
    .btn-connection-mode, .btn-clear-connections, .btn-save-connections {
        padding: 8px 14px;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        margin-right: 10px;
        font-weight: bold;
        color: white;
    }
    
    .btn-connection-mode {
        background-color: #22aa22;
    }
    
    .btn-connection-mode.active {
        background-color: #22aa22;
    }
    
    /* Versão verde quando ativo, cinza quando desligado */
    #toggleConnectionMode {
        background-color: #22aa22;
    }
    
    #toggleConnectionMode.inactive {
        background-color: #5a5a5a;
    }
    
    .btn-clear-connections {
        background-color: #d32f2f;
    }
    
    .btn-save-connections {
        background-color: #1976d2;
    }
    
    .connection-controls {
        display: flex;
        margin: 15px 0;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .connection-instructions {
        background-color: #ffd;
        padding: 10px;
        border-radius: 4px;
        border-left: 4px solid #fb1;
        margin-bottom: 15px;
    }
    
    .connectable {
        position: relative;
        padding: 8px 15px; /* Reduced padding since we're removing the left circles */
        cursor: pointer;
        margin: 5px 0;
        white-space: normal; /* Allow text to wrap */
        overflow: visible; /* Show all text */
        line-height: 1.4;
        border-radius: 4px;
        transition: all 0.2s ease;
    }
    
    /* Remove the circle connection point on left */
    .connectable:before {
        display: none; /* Hide the circles instead of removing the rule completely */
    }
    
    /* Connection points for anchor lines */
    .connectable .connection-point-left,
    .connectable .connection-point-right {
        display: none; /* Hide the internal connection points */
    }
    
    /* Section-specific colors for connection points - no longer needed since circles are hidden */
    .connectable[data-section="Competencia"]:before,
    .connectable[data-section="Avaliacao"]:before,
    .connectable[data-section="Conteudo"]:before,
    .connectable[data-section="Atividade"]:before {
        display: none;
    }
    
    .edvee-matrix {
        display: flex;
        flex-direction: column;
        gap: 80px; /* Significantly increased gap between rows to match the image */
        margin-top: 30px;
        background: transparent;
        position: relative; 
        overflow: visible;
        width: 100%;
        padding-bottom: 100px; /* Added more space at bottom */
    }
    
    .edvee-row {
        display: flex;
        justify-content: space-between;
        position: relative;
        gap: 100px; /* Significantly increased horizontal gap between sections */
    }
    
    /* Improved connector positioning */
    .connectable {
        position: relative;
        padding: 8px 15px; /* Reduced padding since we're removing the left circles */
        cursor: pointer;
        margin: 5px 0;
        white-space: normal; /* Allow text to wrap */
        overflow: visible; /* Show all text */
        line-height: 1.4;
        border-radius: 4px;
        transition: all 0.2s ease;
    }
    
    /* Remove the circle connection point on left */
    .connectable:before {
        display: none; /* Hide the circles instead of removing the rule completely */
    }
    
    /* Connection points for anchor lines */
    .connectable .connection-point-left,
    .connectable .connection-point-right {
        display: none; /* Hide the internal connection points */
    }
    
    /* Section-specific colors for connection points - no longer needed since circles are hidden */
    .connectable[data-section="Competencia"]:before,
    .connectable[data-section="Avaliacao"]:before,
    .connectable[data-section="Conteudo"]:before,
    .connectable[data-section="Atividade"]:before {
        display: none;
    }
    
    .edvee-box {
        flex: 1;
        background-color: #fff;
        padding: 0;
        border-radius: 8px; /* Slightly rounder corners */
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
        overflow: visible; /* Alterado de hidden para visible para permitir que as conexões sejam visíveis */
        min-width: 40%; /* Slightly reduced to allow more space between boxes */
        max-width: 45%; /* Add max-width to maintain proportions */
        margin-bottom: 20px;
        z-index: 1; /* Garante que as caixas fiquem abaixo das linhas de conexão */
    }
    
    .edvee-box:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .edvee-box h3 {
        margin: 0;
        padding: 15px 20px; /* Increased padding for header */
        font-size: 18px; /* Larger font size */
        color: #fff;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
    }
    
    .edvee-box.competencias h3 {
        background-color: #e91e63;
    }
    
    .edvee-box.avaliacoes h3 {
        background-color: #2196f3;
    }
    
    .edvee-box.conteudos h3 {
        background-color: #ffc107;
    }
    
    .edvee-box.atividades h3 {
        background-color: #4caf50;
    }
    
    .edvee-table {
        display: flex;
        flex-direction: column;
        gap: 15px; /* Increased gap between cells */
        padding: 15px;
    }
    
    .edvee-table .edvee-row {
        display: flex;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #eee;
    }
    
    .edvee-table .edvee-row:hover {
        background: #f9f9f9;
    }
    
    .edvee-cell {
        flex: 1;
        padding: 0 8px; /* Increased horizontal padding */
        color: #333;
        font-size: 14px;
        line-height: 1.5; /* Added line height for better readability */
    }
    
    .edvee-cell.actions {
        flex: none;
        width: 40px;
        white-space: nowrap;
        text-align: right;
        margin-left: 10px; /* Added margin to separate from content */
    }
    
    .edvee-cell a {
        transition: color 0.3s;
    }
    
    /* Dropdown menu styles */
    .dropdown {
        position: relative;
        display: inline-block;
    }

    .dropbtn {
        background-color: transparent;
        color: #555;
        font-size: 18px;
        font-weight: bold;
        border: none;
        cursor: pointer;
        padding: 5px 10px;
        border-radius: 4px;
    }

    .dropbtn:hover {
        background-color: #f1f1f1;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        right: 0;
        background-color: #f9f9f9;
        min-width: 120px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
        border-radius: 4px;
    }

    .dropdown:hover .dropdown-content {
        display: block;
    }

    .dropdown-content a {
        color: #333;
        padding: 8px 12px;
        text-decoration: none;
        display: block;
        border-bottom: 1px solid #eee;
    }

    .dropdown-content a:hover {
        background-color: #f1f1f1;
    }

    .dropdown-btn {
        background: none;
        border: none;
        color: #f44336;
        cursor: pointer;
        font-size: 14px;
        padding: 8px 12px;
        width: 100%;
        text-align: left;
    }

    .dropdown-btn:hover {
        background-color: #f1f1f1;
    }
    
    /* Button for adding a new component */
    .btn-add {
        background-color: #2196f3;
        color: #fff;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
        margin-top: 10px;
    }

    .btn-add:hover {
        background-color: #1976d2;
    }
        
    /* Melhoria para a aparência das conexões */
    .leader-line {
        z-index: 100 !important; /* Garante que as linhas sempre aparecem acima do conteúdo */
    }
    
    /* Novo estilo para pontos de conexão fora das tabelas */
    .connection-point-container {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 0;
        z-index: 5;
    }
    
    /* Container para pontos à esquerda */
    .connection-points-left {
        left: -15px;
    }
    
    /* Container para pontos à direita */
    .connection-points-right {
        right: -15px;
    }
    
    /* Para melhor visualização dos pontos de conexão */
    .connectable {
        position: relative;
        padding: 10px 15px;
        cursor: pointer;
        margin: 8px 0;
    }
      .connection-point {
        position: absolute;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background-color: white;
        border: 2px solid;
        z-index: 10;
        cursor: pointer;
        transform: translateX(-50%); /* Centraliza horizontalmente */
        box-sizing: border-box;
    }
      .connection-point[data-section="Competencia"] {
        border-color: #e91e63;
    }
    
    .connection-point[data-section="Avaliacao"] {
        border-color: #2196f3;
    }
    
    .connection-point[data-section="Conteudo"] {
        border-color: #ffc107;
    }
    
    .connection-point[data-section="Atividade"] {
        border-color: #4caf50;
    }
    
    /* Ajustes nas caixas para acomodar o novo layout */
    .edvee-box {
        position: relative;
        overflow: visible;
        z-index: 1;
    }

    form input[type="text"] {
        width: calc(100% - 30px);
        padding: 10px 12px;
        margin: 8px 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        transition: border-color 0.3s;
        font-size: 14px;
    }
</style>
